@model IEnumerable<BtnNewPinpad.Models.Pinpad>

@{
  int totalPages = (int)Math.Ceiling((double)ViewBag.TotalItems / ViewBag.PageSize);
  int currentPage = ViewBag.CurrentPage;
}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pinpad Monitoring</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-800">

  <div class="p-6">
    <!-- Title -->
    <h1 class="text-2xl font-bold mb-4">ðŸ“Š Pinpad Monitoring</h1>

    <!-- Export Buttons + Search & Pagination -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-3">
      <!-- Export Buttons -->
      <div class="flex gap-2">
        <a href="@Url.Action("ExportPdf", new { searchString = ViewBag.SearchString })" target="_blank"
          class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">PDF</a>
        <button class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Excel</button>
        <button class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">CSV</button>
      </div>

      <!-- Search + Pagination Size -->
      <div class="flex items-center gap-3">
        <form method="get" asp-action="Monitoring" class="flex items-center gap-3">
          <input type="text" name="searchString" value="@ViewContext.HttpContext.Request.Query["searchString"]"
            placeholder="Search..."
            class="border border-gray-300 px-4 py-2 rounded focus:ring-2 focus:ring-blue-400 w-48">
          <select name="pageSize" onchange="this.form.submit()"
            class="border border-gray-300 px-3 py-2 rounded focus:ring-2 focus:ring-blue-400">
            <option value="5" selected="@(ViewBag.PageSize == 5)">5</option>
            <option value="10" selected="@(ViewBag.PageSize == 10)">10</option>
            <option value="25" selected="@(ViewBag.PageSize == 25)">25</option>
          </select>
          <button type="submit" class="hidden">Search</button>
        </form>
      </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto bg-white shadow rounded-lg">
      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="bg-gray-200 text-gray-700">
            <th class="px-4 py-2">Cabang Induk</th>
            <th class="px-4 py-2">Kode Outlet</th>
            <th class="px-4 py-2">Location</th>
            <th class="px-4 py-2">Tanggal Register</th>
            <th class="px-4 py-2">Serial Number</th>
            <th class="px-4 py-2">TID</th>
            <th class="px-4 py-2">Status Pinpad</th>
            <th class="px-4 py-2">Create By</th>
            <th class="px-4 py-2">IP Low</th>
            <th class="px-4 py-2">IP High</th>
            <th class="px-4 py-2">Last Login</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          @foreach (var item in Model)
          {
            <tr>
              @* <td class="px-4 py-2">@item.ParentBranch</td> *@
              <td class="px-4 py-2">@item.OutletCode</td>
              <td class="px-4 py-2">@item.Location</td>
              @* <td class="px-4 py-2">@item.RegistrationDate?.ToString("yyyy-MM-dd HH:mm:ss")</td> *@
              <td class="px-4 py-2">@item.SerialNumber</td>
              <td class="px-4 py-2">@item.TerminalId</td>
              <td class="px-4 py-2">
                @if (item.PinpadStatus?.ToLower() == "inactive")
                {
                  <span class="badge bg-warning text-dark">Inactive</span>
                }
                else if (item.PinpadStatus?.ToLower().Contains("not ready") == true)
                {
                  <span class="badge bg-danger">Not Ready To Use</span>
                }
                else
                {
                  @item.PinpadStatus
                }
              </td>
              <td class="px-4 py-2">@item.CreatedBy</td>
              <td class="px-4 py-2">@item.IpLow</td>
              <td class="px-4 py-2">@item.IpHigh</td>
              @* <td class="px-4 py-2">@item.LastLogin?.ToString("yyyy-MM-dd HH:mm:ss")</td> *@
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination Buttons -->
    <div class="flex justify-end mt-4 gap-2">
      @if (currentPage > 1)
      {
        <a href="@Url.Action("Monitoring", new { pageNumber = currentPage - 1, pageSize = ViewBag.PageSize, searchString = ViewBag.SearchString })"
          class="px-3 py-1 border rounded hover:bg-gray-100">Prev</a>
      }

      @for (int i = 1; i <= totalPages; i++)
      {
        if (i == currentPage)
        {
          <span class="px-3 py-1 border rounded bg-blue-500 text-white">@i</span>
        }
        else
        {
          <a href="@Url.Action("Monitoring", new { pageNumber = i, pageSize = ViewBag.PageSize, searchString = ViewBag.SearchString })"
            class="px-3 py-1 border rounded hover:bg-gray-100">@i</a>
        }
      }

      @if (currentPage < totalPages)
      {
        <a href="@Url.Action("Monitoring", new { pageNumber = currentPage + 1, pageSize = ViewBag.PageSize, searchString = ViewBag.SearchString })"
          class="px-3 py-1 border rounded hover:bg-gray-100">Next</a>
      }
    </div>
  </div>

</body>

</html>
